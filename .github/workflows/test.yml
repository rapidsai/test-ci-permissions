name: Test image

on:
  workflow_dispatch:

defaults:
  run:
    shell: bash

permissions:
  actions: read
  checks: none
  contents: read
  deployments: none
  discussions: none
  id-token: write
  issues: none
  packages: read
  pages: none
  pull-requests: read
  repository-projects: none
  security-events: none
  statuses: none


jobs:
  test-ubuntu:
    runs-on: "ubuntu-latest"
    container:
      image: rapidsai/test-ci-permissions:latest
      env:
        GHA_TOOLS_DIR: /home/rapids/.local/bin
        PATH: $PATH:${{env.GHA_TOOLS_DIR}}
    steps:
      - name: Install gha-tools
        run: |
          set -x
          whoami
          id
          pwd
          ls -la .
          ls -la "${GITHUB_PATH}"

          mamba install -y curl

          mkdir -p "${{env.GHA_TOOLS_DIR}}"
          curl -s -L 'https://github.com/rapidsai/gha-tools/releases/latest/download/tools.tar.gz' | tar -xz -C "${{env.GHA_TOOLS_DIR}}"
      - name: Test gha-tools
        run: rapids-logger "Test message"
