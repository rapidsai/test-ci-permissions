name: Test image

on:
  workflow_dispatch:

defaults:
  run:
    shell: bash

permissions:
  actions: read
  checks: none
  contents: read
  deployments: none
  discussions: none
  id-token: write
  issues: none
  packages: read
  pages: none
  pull-requests: read
  repository-projects: none
  security-events: none
  statuses: none


jobs:
  test:
    runs-on: "linux-amd64-gpu-v100-latest-1"
    container:
      image: rapidsai/test-ci-permissions:latest
      env:
        NVIDIA_VISIBLE_DEVICES: ${{ env.NVIDIA_VISIBLE_DEVICES }}
    steps:
      - name: Install gha-tools
        run: |
          set -x
          whoami
          id
          pwd
          ls -la .
          ls -la "${GITHUB_PATH}"

          mamba install -y curl

          mkdir -p /tmp/gha-tools
          curl -s -L 'https://github.com/rapidsai/gha-tools/releases/latest/download/tools.tar.gz' | tar -xz -C /tmp/gha-tools
          echo "/tmp/gha-tools" >> "${GITHUB_PATH}"
